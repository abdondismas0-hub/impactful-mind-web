{% extends "base.html" %}

{% block content %}

    <!-- 1. SLIDESHOW (CAROUSEL) - FIXED JS -->
    <div class="carousel-container" style="margin-bottom: 40px; position: relative; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.3); min-height: 450px;">
        {% if carousel_posts %}
            <!-- Slide Container -->
            <div id="slides-wrapper">
                {% for post in carousel_posts %}
                <div class="mySlides fade" style="display: none; width: 100%; height: 450px; background-image: url('{{ url_for('download_book', filename=post.image_file) }}'); background-size: cover; background-position: center; position: relative;">
                    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4);"></div>
                    <div class="carousel-caption" style="position: absolute; bottom: 0; width: 100%; padding: 30px; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); color: white;">
                        <h2 style="color: #f1c40f; text-shadow: 2px 2px 4px #000;">{{ post.title }}</h2>
                        <a href="{{ url_for('view_post', post_id=post.id) }}" class="btn" style="margin-top: 10px; background-color: #3498db;">Soma Zaidi</a>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Dots/Circles -->
            <div style="text-align:center; position: absolute; bottom: 10px; width: 100%;">
                {% for post in carousel_posts %}
                <span class="dot" onclick="currentSlide({{ loop.index }})"></span>
                {% endfor %}
            </div>
        {% else %}
            <div class="glass-panel" style="text-align: center; padding: 100px 20px; background: linear-gradient(135deg, #1e3c72, #2a5298); height: 450px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                <h1 style="color: #f1c40f; font-size: 3rem;">Karibu Impactful Mind</h1>
                <p style="color: white; font-size: 1.3rem;">Jenga Akili Yako, Badilisha Maisha Yako.</p>
                <a href="{{ url_for('library') }}" class="btn" style="background-color: #f1c40f; color: #000;">Ingia Maktaba</a>
            </div>
        {% endif %}
    </div>

    <!-- 2. FOUNDER SECTION -->
    <section class="glass-panel" style="padding: 40px; margin-bottom: 40px;">
        <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 40px;">
            <div style="flex: 1 1 250px; text-align: center;">
                <div style="width: 250px; height: 250px; margin: 0 auto; border-radius: 20px; overflow: hidden; border: 4px solid #f1c40f; box-shadow: 0 0 20px rgba(241, 196, 15, 0.3);">
                    {% if about_info and about_info.founder_image %}
                        <img src="{{ url_for('download_book', filename=about_info.founder_image) }}" style="width: 100%; height: 100%; object-fit: cover;">
                    {% else %}
                        <div style="width: 100%; height: 100%; background: #2c3e50; display: flex; align-items: center; justify-content: center;"><i class="fas fa-user fa-5x" style="color: #7f8c8d;"></i></div>
                    {% endif %}
                </div>
            </div>
            <div style="flex: 2 1 400px;">
                <h2 style="color: #f1c40f; border-bottom: 2px solid #f1c40f; display: inline-block;">Kutana na Mwanzilishi</h2>
                <h3 style="color: white; margin-top: 15px;">{{ about_info.founder_name if about_info else 'Jina la Mwanzilishi' }}</h3>
                <p style="color: #ddd; line-height: 1.8; margin-bottom: 25px; white-space: pre-wrap;">{{ about_info.founder_bio if about_info else 'Maelezo...' }}</p>
                <a href="{{ url_for('contact') }}" class="btn" style="background-color: #2ecc71;"><i class="fas fa-envelope"></i> Wasiliana Naye</a>
            </div>
        </div>
    </section>

    <!-- 3. VIDEO SECTION (MPYA) -->
    {% if videos %}
    <section class="glass-panel" style="margin-bottom: 40px;">
        <h3 style="color: #f1c40f; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; margin-bottom: 20px;">
            <i class="fas fa-video"></i> Video Mpya
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            {% for video in videos %}
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                <video width="100%" controls style="border-radius: 10px; margin-bottom: 10px;">
                    <source src="{{ url_for('download_book', filename=video.video_file) }}" type="video/mp4">
                    Browser yako haikubali video hii.
                </video>
                <h4 style="color: white; margin: 5px 0;">{{ video.title }}</h4>
                <p style="color: #ccc; font-size: 0.9rem;">{{ video.description }}</p>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- 4. LATEST CONTENT -->
    <div style="display: flex; flex-wrap: wrap; gap: 20px;">
        <div class="glass-panel" style="flex: 1 1 300px;">
            <h3 style="color: #f1c40f;">Daily Posts</h3>
            <ul style="list-style: none; padding: 0;">
                {% for post in posts %}
                    <li style="padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);"><a href="{{ url_for('view_post', post_id=post.id) }}" style="color: white; font-weight: bold; text-decoration: none;">{{ post.title }}</a></li>
                {% endfor %}
            </ul>
        </div>
        <div class="glass-panel" style="flex: 1 1 300px;">
            <h3 style="color: #f1c40f;">Vitabu</h3>
            <ul style="list-style: none; padding: 0;">
                {% for book in books %}
                    <li style="padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between;"><span style="color: white;">{{ book.title }}</span><a href="{{ url_for('download_book', filename=book.file_path) }}" style="color: #2ecc71;">PDF</a></li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- STYLE & SCRIPT KWA CAROUSEL -->
    <style>
        .fade { animation-name: fade; animation-duration: 1.5s; }
        @keyframes fade { from {opacity: .4} to {opacity: 1} }
        .dot { cursor: pointer; height: 10px; width: 10px; margin: 0 2px; background-color: #bbb; border-radius: 50%; display: inline-block; transition: background-color 0.6s ease; }
        .dot:hover, .dot.active { background-color: #f1c40f; }
    </style>

    <script>
        let slideIndex = 0;
        showSlides();

        function showSlides() {
            let i;
            let slides = document.getElementsByClassName("mySlides");
            let dots = document.getElementsByClassName("dot");
            if (slides.length === 0) return;
            
            for (i = 0; i < slides.length; i++) {
                slides[i].style.display = "none";  
            }
            slideIndex++;
            if (slideIndex > slides.length) {slideIndex = 1}    
            
            for (i = 0; i < dots.length; i++) {
                dots[i].className = dots[i].className.replace(" active", "");
            }
            slides[slideIndex-1].style.display = "block";  
            if (dots.length > 0) dots[slideIndex-1].className += " active";
            setTimeout(showSlides, 5000); 
        }
    </script>

{% endblock %}


