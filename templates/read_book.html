{% extends "base.html" %}

{% block content %}
<div style="padding-top: 30px; height: 90vh; display: flex; flex-direction: column; max-width: 1200px; margin: auto;">
    
    <!-- Header -->
    <div class="glass-panel" style="padding: 10px 20px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
        <h2 style="color: var(--accent); margin: 0; font-size: 1rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
            {{ book.title }}
        </h2>
        <a href="{{ url_for('library') }}" class="btn" style="background: transparent; border: 1px solid white; padding: 5px 15px; font-size: 0.8rem; color: white;">
            <i class="fas fa-times"></i> Funga
        </a>
    </div>

    <!-- PDF VIEWER CONTAINER -->
    <div class="glass-panel" style="padding: 0; overflow: hidden; flex-grow: 1; background: #fff; border-radius: 10px; position: relative;">
        
        <!-- ULINZI: Tunahakikisha file_path ipo kabla ya kuitumia -->
        {% if book.file_path %}
            
            <!-- GOOGLE DOCS VIEWER (Hii ndiyo inafanya PDF isomeke online kwenye simu zote) -->
            <iframe 
                src="https://docs.google.com/gview?url={{ book.file_path }}&embedded=true" 
                style="width:100%; height:100%; border: none;" 
                frameborder="0">
            </iframe>

            <!-- Fallback: Link ya Dharura (Itaonekana kama Google ikichelewa) -->
            <div style="position: absolute; bottom: 0; width: 100%; text-align: center; pointer-events: none;">
                <a href="{{ book.file_path }}" target="_blank" style="pointer-events: auto; background: rgba(0,0,0,0.8); color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.7rem; text-decoration: none;">
                    Ikiwa haifunguki, bofya hapa
                </a>
            </div>

        {% else %}
            <!-- Kama Database haina link ya kitabu hiki -->
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #333; flex-direction: column;">
                <i class="fas fa-exclamation-triangle fa-3x" style="color: #e74c3c; margin-bottom: 15px;"></i>
                <h3>Samahani, faili la kitabu halikupatikana.</h3>
                <p>Tafadhali wasiliana na Admin.</p>
            </div>
        {% endif %}

    </div>

</div>
{% endblock %}


